import{d as i}from"./settings.js";async function s(){return(await chrome.storage.local.get(["settings"])).settings||structuredClone(i)}async function o(t){await chrome.storage.local.set({settings:t})}chrome.tabs.onCreated.addListener(async t=>{if(!(await s()).preserveEmpty)try{await Promise.allSettled((await chrome.tabs.query({currentWindow:!0,url:"chrome://newtab/"})).map(async e=>{e.id&&e.id!==t.id&&await chrome.tabs.remove(e.id)}))}catch{}});async function c(){const t=await chrome.windows.getCurrent({populate:!0});if(!t.tabs||t.tabs.length===0)return;const a=t.tabs.find(r=>r.active);if(!a||!a.id)return;const e=await s();if(!(e.preservePinned&&a.pinned||e.preserveGrouped&&a.groupId!==-1))try{t.tabs.filter(n=>!n.pinned&&n.groupId===-1&&n.id!==a.id).length||await chrome.tabs.create({}),await chrome.tabs.remove(a.id)}catch{}}chrome.runtime.onMessage.addListener((t,a,e)=>{switch(t.type){case"getCommands":return chrome.commands.getAll().then(r=>e(r)),!0;case"getSettings":return s().then(r=>e(r)),!0;case"saveSettings":return o(t.payload),!1}});chrome.commands.onCommand.addListener(async t=>{t==="close"&&await c()});
